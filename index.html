<!DOCTYPE html>
<html>
<head>
    <title>Basketball for Mental Health</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; display: flex; justify-content: center; background: #000; }
        canvas { border: 2px solid #333; }
    </style>
</head>
<body>

<script>
const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,// size of the main screen
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 300 }, // how fast the ball falls
            debug: false
        }
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

const game = new Phaser.Game(config); // start new phaser game

let mentalClarity = 0; // 0 = Chaos, 100 = Healthy Mental Health
let chaosIntensity = 1; // Used for screen shake
let scoreText;
let instructionText;
let isGameRunning = false;

function preload () {
    // Load assets here (images, audio)
    // For now, we will draw shapes programmatically so you don't need external files to test this
}

function create () {

    this.bg = this.add.rectangle(400, 300, 800, 600, 0x220000); // Dark Red (Stress)
    
    const graphics = this.make.graphics({ x: 0, y: 0, add: false });
    graphics.fillStyle(0xFFA500, 1);
    graphics.fillCircle(20, 20, 20);
    graphics.lineStyle(2, 0x000000);
    graphics.strokeCircle(20, 20, 20);
    graphics.beginPath();
    graphics.moveTo(0, 20);
    graphics.lineTo(40, 20);
    graphics.moveTo(20, 0);
    graphics.lineTo(20, 40);
    graphics.strokePath();
    graphics.generateTexture('basketball', 40, 40);

    this.ball = this.physics.add.sprite(100, 500, 'basketball'); // Start position
    this.ball.setCircle(20);
    this.ball.setCollideWorldBounds(true); // cannot go through walls
    this.ball.setBounce(0.8); // how hight the ball will bounce up

    const backboard = this.add.rectangle(700, 200, 10, 100, 0xFFFFFF); // backboard
    this.physics.add.existing(backboard, true); // Static
    this.physics.add.collider(this.ball, backboard);

    this.add.rectangle(660, 230, 80, 5, 0xFF0000);// rim
    
    this.hoopSensor = this.add.zone(660, 250, 60, 40);
    this.physics.add.existing(this.hoopSensor, true);
    this.physics.add.overlap(this.ball, this.hoopSensor, checkScore, null, this);

    scoreText = this.add.text(16, 16, 'Mental Clarity: 0%', { fontSize: '32px', fill: '#fff' }); // initially at zero %
    instructionText = this.add.text(250, 500, 'Use ARROW KEYS to move & jump', { fontSize: '20px', fill: '#aaa' });

    this.cursors = this.input.keyboard.createCursorKeys();
    this.jumps = 0;

    // Start Screen
    this.physics.pause();
    
    const startScreen = this.add.container(0, 0);
    const overlay = this.add.rectangle(400, 300, 800, 600, 0x000000, 0.7);
    const title = this.add.text(400, 150, 'Basketball for Mental Health', { fontSize: '40px', fill: '#fff', fontStyle: 'bold' }).setOrigin(0.5);
    const instructions = this.add.text(400, 250, 'Use ARROW KEYS to move & jump.\nScore baskets to gain Mental Clarity.', { fontSize: '20px', fill: '#ddd', align: 'center' }).setOrigin(0.5);
    const playBtnBg = this.add.rectangle(400, 400, 200, 60, 0x4488ff).setInteractive({ useHandCursor: true });
    const playBtnText = this.add.text(400, 400, 'PLAY', { fontSize: '32px', fill: '#fff' }).setOrigin(0.5);
    
    startScreen.add([overlay, title, instructions, playBtnBg, playBtnText]);

    playBtnBg.on('pointerdown', () => {
        startScreen.destroy();
        this.physics.resume();
        isGameRunning = true;
    });
}

function update () {
    if (!isGameRunning) return;

    if (mentalClarity < 100) {
        let shakeAmount = (100 - mentalClarity) / 5000; 
        this.cameras.main.shake(100, shakeAmount); // keep shaking until we reach mental clarity
    }

    if (mentalClarity >= 100) {
        instructionText.setText("The mind is calm now.");
    }

    // Smooth color transition
    const startColor = Phaser.Display.Color.ValueToColor(0x220000);
    const endColor = Phaser.Display.Color.ValueToColor(0x4488ff);
    
    const colorObject = Phaser.Display.Color.Interpolate.ColorWithColor(
        startColor, 
        endColor, 
        100, 
        Math.min(mentalClarity, 100)
    );

    const color = Phaser.Display.Color.GetColor(colorObject.r, colorObject.g, colorObject.b);
    this.bg.fillColor = color;

    // Controls
    if (this.cursors.left.isDown) {
        this.ball.setVelocityX(-200);
    } else if (this.cursors.right.isDown) {
        this.ball.setVelocityX(200);
    } else {
        this.ball.setVelocityX(this.ball.body.velocity.x * 0.95); // Drag
    }

    if (this.ball.body.blocked.down) {
        this.jumps = 2;
    }

    if (Phaser.Input.Keyboard.JustDown(this.cursors.up) && this.jumps > 0) {
        this.ball.setVelocityY(-500);
        this.jumps--;
    }
}

function checkScore (ball, sensor) {
    // Check if ball is moving downwards
    if (ball.body.velocity.y > 0 && mentalClarity < 100) {
        
        if (!ball.isScoring) {
            ball.isScoring = true;
            mentalClarity += 25;
            scoreText.setText('Mental Clarity: ' + mentalClarity + '%');
            
            scoreText.setColor('#00ff00'); // for a brief moment text should be green to indicate progress
            this.time.delayedCall(200, () => scoreText.setColor('#fff'));
            
            // Reset scoring flag
            this.time.delayedCall(1000, () => { ball.isScoring = false; });
        }
    }
}
</script>

</body>
</html>